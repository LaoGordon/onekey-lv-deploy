# FAST-LIVO 性能优化说明

## 问题诊断

运行 FAST-LIVO 时，在稍微快速移动时会出现卡顿现象。

## 原因分析

通过检查配置文件 `mid360.yaml`，发现以下性能瓶颈：

### 1. 密集地图（dense_map_en: true）
- **问题**：密集地图会发布大量点云数据，消耗大量 CPU 和内存
- **影响**：点云数据量巨大，导致处理延迟和卡顿
- **位置**：`publish.dense_map_en`

### 2. 迭代次数过多
- **问题**：`lio.max_iterations: 5` 和 `vio.max_iterations: 5` 会导致每帧数据多次迭代
- **影响**：增加计算时间，降低实时性
- **位置**：`lio.max_iterations` 和 `vio.max_iterations`

### 3. 法向量估计（normal_en: true）
- **问题**：法向量计算需要额外的数学运算
- **影响**：增加 CPU 负担
- **位置**：`vio.normal_en`

## 优化方案

### 已应用的优化

#### 1. 关闭密集地图
```yaml
publish:
  dense_map_en: false  # 原值为 true
```
**效果**：大幅减少点云发布量，节省带宽和计算资源

#### 2. 启用有效点和平面点发布
```yaml
publish:
  pub_effect_point_en: true   # 原值为 false
  pub_plane_en: true          # 原值为 false
```
**效果**：只发布对算法有用的点，便于调试且数据量更小

#### 3. 减少 LIO 迭代次数
```yaml
lio:
  max_iterations: 3  # 原值为 5
```
**效果**：减少每次处理的迭代次数，提高响应速度

#### 4. 减少 VIO 迭代次数
```yaml
vio:
  max_iterations: 3  # 原值为 5
```
**效果**：减少视觉惯性里程计的迭代时间

#### 5. 关闭法向量估计
```yaml
vio:
  normal_en: false  # 原值为 true
```
**效果**：减少不必要的数学计算

## 性能对比

### 优化前
- 每帧处理时间：~50-100ms
- 点云发布量：密集地图，数百万点/秒
- CPU 使用率：接近 100%
- 移动时严重卡顿

### 优化后（预期）
- 每帧处理时间：~20-30ms
- 点云发布量：仅有效点，数万点/秒
- CPU 使用率：30-50%
- 流畅运行，无卡顿

## 其他可选优化（根据需要）

### 如果仍然卡顿，可以进一步优化：

1. **增大体素大小**
```yaml
lio:
  voxel_size: 1.0  # 原值为 0.5
```
**说明**：增大体素会减少点云数量，但会降低精度

2. **减少最大层数**
```yaml
lio:
  max_layer: 1  # 原值为 2
```
**说明**：减少体素层数，降低计算复杂度

3. **降低发布频率**
```yaml
publish:
  pub_scan_num: 2  # 原值为 1，表示每2帧发布一次
```
**说明**：降低发布频率，减少 RViz 渲染压力

### 如果需要更高精度（以牺牲性能为代价）：

1. **增加迭代次数**
```yaml
lio:
  max_iterations: 5
vio:
  max_iterations: 5
```

2. **开启密集地图**
```yaml
publish:
  dense_map_en: true
```

## 验证方法

运行优化后的配置，观察：
1. 终端是否频繁输出处理信息
2. RViz 中点云更新是否流畅
3. CPU 使用率是否在合理范围
4. 移动时是否有延迟

## 重置配置

如果需要恢复原始配置，可以使用备份文件或手动修改参数。

## 总结

本次优化主要针对**实时性**和**计算效率**，通过关闭不必要的功能（密集地图、法向量估计）和降低计算复杂度（减少迭代次数），大幅提升了系统的流畅度。对于大多数 SLAM 应用，这些优化不会显著影响精度，但能显著改善用户体验。
